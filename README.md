# TTSaveAPI

Этот API предоставляет эндпоинты для скачивания и стриминга видео или фото с TikTok. Он поддерживает скачивание файлов по URL TikTok, стриминг загруженных файлов и обработку ошибок.

## Базовый URL
```
http://45.11.229.38:4347
```

## Эндпоинты

### 1. **POST /download**

Этот эндпоинт принимает URL TikTok, скачивает связанное с ним видео или фото и предоставляет пути к сохраненным файлам.

#### Запрос

- **URL**: `/download`
- **Метод**: `POST`
- **Тело запроса**: 
  - **Content-Type**: `application/json`
  - **Параметры**:
    - `url` (string): Полный URL видео или фото из TikTok (например, `https://www.tiktok.com/@author123/video/312132123123132`).

#### Пример запроса:

```json
{
  "url": "https://www.tiktok.com/@author123/video/312132123123132"
}
```

#### Ответ

- **Content-Type**: `application/json`
- **Тело ответа**:
  - `files` (массив объектов): Список файлов, связанных с загруженным медиа, с именем файла и URL для стриминга.
    - `name` (string): Имя загруженного файла.
    - `url` (string): URL для стриминга файла.

#### Пример ответа:

```json
{
  "files": [
    {
      "name": "312132123123132.mp4",
      "url": "/stream/312132123123132.mp4"
    }
  ]
}
```

#### Ошибки:
- **400 Bad Request**: Если параметр `url` отсутствует или некорректен.
    - Пример: `{ "detail": "URL is required" }`
- **500 Internal Server Error**: Если не удалось скачать файл.
    - Пример: `{ "detail": "Failed to save the file" }`
- **404 Not Found**: Если файлы не были найдены после скачивания.
    - Пример: `{ "detail": "Files not found: 312132123123132.mp4" }`

### 2. **GET /stream/{filename}**

Этот эндпоинт позволяет стримить загруженные файлы с сервера. Вы можете стримить видео или фото, которые были ранее загружены.

#### Запрос

- **URL**: `/stream/{filename}`
- **Метод**: `GET`
- **Параметры**:
  - `filename` (string): Имя файла, который вы хотите стримить (например, `312132123123132.mp4`).

#### Пример запроса:

```
GET /stream/312132123123132.mp4
```

#### Ответ

- **Content-Type**: `application/octet-stream`
- **Тело ответа**: Стримит запрашиваемый файл как бинарный поток.

#### Пример ответа:

Файл будет стримиться клиенту, начиная с начала.

#### Ошибки:
- **404 Not Found**: Если файл не существует на сервере.
    - Пример: `{ "detail": "File not found" }`

### 3. **Обработчики Исключений**

Этот API имеет кастомные обработчики исключений, которые возвращают структурированные сообщения об ошибках:

#### 3.1. **Глобальный Обработчик Исключений**
Обрабатывает неожиданные ошибки, логирует сообщение об ошибке и возвращает общее сообщение "Internal Server Error".

#### Пример ответа:

```json
{
  "message": "Internal Server Error",
  "detail": "Error: <message об ошибке>"
}
```

#### 3.2. **Обработчик Ошибок Валидности Запроса**
Обрабатывает некорректный ввод или отсутствие параметров и возвращает подробное сообщение о валидности.

#### Пример ответа:

```json
{
  "message": "Validation Error",
  "detail": [
    {
      "loc": ["body", "url"],
      "msg": "field required",
      "type": "value_error.missing"
    }
  ]
}
```

#### 3.3. **Обработчик Исключений HTTP (Starlette)**
Обрабатывает ошибки, связанные с HTTP, и возвращает структурированное сообщение на основе данных исключения.

#### Пример ответа:

```json
{
  "message": "Files not found: 312132123123132.mp4"
}
```

---

## Как работает API

1. **Процесс скачивания**:
   - Пользователь отправляет URL TikTok на эндпоинт `/download`. Сервер обрабатывает URL и скачивает видео или фото.
   - Сервер сохраняет медиа в указанную директорию и возвращает список файлов с URL для стриминга.
  
2. **Стриминг**:
   - Пользователи могут стримить загруженные медиа через эндпоинт `/stream/{filename}`. Сервер передает файл как бинарный поток.

3. **Обработка ошибок**:
   - API имеет несколько механизмов обработки ошибок для некорректного ввода, отсутствующих файлов или неожиданных ошибок.

---


## Примечания

- API требует валидный URL TikTok для обработки запроса.
- Ошибки логируются на сервере и возвращаются клиенту как структурированные JSON ответы.

